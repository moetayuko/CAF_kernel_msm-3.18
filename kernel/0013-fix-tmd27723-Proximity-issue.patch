From fd60cf6cf61ed0fe2eb22a5d596bc006f02627aa Mon Sep 17 00:00:00 2001
From: lnxbuild <lnxbuild@localhost>
Date: Mon, 9 Sep 2013 12:23:46 +0800
Subject: [PATCH 13/14] fix tmd27723 Proximity issue

Change-Id: Idf5929c4cab093fb795fb7b4cf575df18bc6875b
---
 arch/arm/boot/dts/msm8610-qrd.dtsi |   14 +++++++-------
 drivers/input/misc/tmd27713.c      |    5 +++--
 2 files changed, 10 insertions(+), 9 deletions(-)

diff --git a/arch/arm/boot/dts/msm8610-qrd.dtsi b/arch/arm/boot/dts/msm8610-qrd.dtsi
index dab2f83..92a33ee 100644
--- a/arch/arm/boot/dts/msm8610-qrd.dtsi
+++ b/arch/arm/boot/dts/msm8610-qrd.dtsi
@@ -209,20 +209,20 @@
 	tmd2772@39 {
 			compatible = "tmd2772,tmd2772";
 			reg = <0x39>;
-            interrupt-parent = <&msmgpio>;
-            interrupts = <80 0x2>;
-            tmd2772,int_gpio = <80>;
+			interrupt-parent = <&msmgpio>;
+			interrupts = <80 0x2>;
+			tmd2772,int_gpio = <80>;
 			tmd2772,proximity_can_wake;
-			tmd2772,prox_th_min = <255>;
-			tmd2772,prox_th_max = <480>;
+			tmd2772,prox_th_min = <900>;
+			tmd2772,prox_th_max = <1000>;
 			tmd2772,als_gate = <10>;
 		};
 
 	taos@3A {
 			compatible = "taos,tmd27713";
 			reg = <0x3A>;
-            interrupt-parent = <&msmgpio>;
-            interrupts = <80 0x2>;
+			interrupt-parent = <&msmgpio>;
+			interrupts = <80 0x2>;
 			vdd-supply = <&pm8110_l19>;
 			vddio-supply = <&pm8110_l6>;
 			taos,real_i2c_addr = <0x39>;
diff --git a/drivers/input/misc/tmd27713.c b/drivers/input/misc/tmd27713.c
index b5a4ea5..b8fabbc 100644
--- a/drivers/input/misc/tmd27713.c
+++ b/drivers/input/misc/tmd27713.c
@@ -898,8 +898,6 @@ static int taos_probe(struct i2c_client *clientp,
 	input_set_capability(taos_datap->als_input_dev, EV_ABS, ABS_MISC);
 	input_set_abs_params(taos_datap->als_input_dev, ABS_MISC, 0, 10000, 0, 0);
 	input_set_abs_params(taos_datap->ps_input_dev, ABS_DISTANCE, 0, 1, 0, 0);
-	ret = input_register_device(taos_datap->als_input_dev);
-	ret = input_register_device(taos_datap->ps_input_dev);
 
 	//check i2c addr
     if((pdata->real_i2c_addr != 0) && pdata->real_i2c_addr != clientp->addr)
@@ -937,6 +935,9 @@ static int taos_probe(struct i2c_client *clientp,
 	strlcpy(clientp->name, TAOS_DEVICE_ID, I2C_NAME_SIZE);
 	strlcpy(taos_datap->taos_name, TAOS_DEVICE_ID, TAOS_ID_NAME_SIZE);
 
+	ret = input_register_device(taos_datap->als_input_dev);
+	ret = input_register_device(taos_datap->ps_input_dev);
+
 	if (!(taos_cfgp = kmalloc(sizeof(struct taos_cfg), GFP_KERNEL))) {
 		printk(KERN_ERR
 		       "TAOS: kmalloc for struct taos_cfg failed in taos_probe()\n");
-- 
1.7.8.3

